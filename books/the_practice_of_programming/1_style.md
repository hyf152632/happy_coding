# 风格

人们看到最好的作家有时并不理会修辞学的规则，还好，当他们这样做虽然付出了违反常规的代价，读者还经常能从句子中发现某些具有补偿性的价值。除非作者自己也明确其做法的意思，否则最好还是按规矩做。

如何从一开始就写出更好的代码，以及如何在代码的发展过程中进一步改进它。

程序设计风格的原则根源于由实际经验中得到的常识，它不是随意的规则或者处方。
代码应该是清楚的和简单的，具有直截了当的逻辑，自然地表达式，通行的语言使用方式，有意义的名字和有帮助作用的注释等，应该避免耍小聪明的花招，不使用非正规的结构。

1. 名字：
   一个变量或函数的名字标识这个对象，带着说明其用途的一些信息。
   一个名字应该是非形式的，简练的，容易记忆的，如果可能得话，最好是能够拼读的。
   许多信息来自上下文和作用范围（作用域）。一个变量的作用域越大，它的名字所携带的信息就应该越多。
   全局变量使用具有说明性的名字，局部变量用短名字。
   按常规方式使用的局部变量可以采用极短的名字。例如用 i,j 作为循环变量，p,q 作为指针，s,t 表示字符串等。
   函数采用动作性的名字。函数名应当用动作性的动词，后面可以跟着名词。
   对返回布尔类型值得函数命名，应该清楚地反映其返回值情况。

2. 表达式和语句
   用缩进显示程序的结构。
   采用一种一致的缩行风格，是使程序呈现出结构清晰地最省力的方法。
   使用表达式的自然形式。含有否定运算的条件表达式比较难理解。
   用加括号的方式排除二义性。
   分解复杂的表达式。
   要清晰。程序员有时把自己无穷尽的创造力用到了写最简短的代码上，或者用在寻求得到结果的最巧妙方法上。有时这种技能是用错了地方，因为我们的目标应该是写出最清晰地代码，而不是最巧妙的代码。
   清晰性并不等同于简短。
   当心副作用

3. 一致性和习惯用法
   一致性带来的将是更好的程序。
   使用一致的缩进和加括号风格。
   此外，如果你工作在一个不是自己写的程序上，请注意保留程序原有的风格。当你需要做修改时，不要使用你自己的风格，即使你特别喜欢它。程序的一致性比你本人的习惯更重要，因为这将使随你之后的其他人生活得更容易些。
   为了一致性，使用习惯用法。

4. 函数宏
   避免函数宏。
   函数宏最常见的一个严重问题是：如果一个参数在定义中出现多次，它就可能被多次求值。如果调用时的实际参数带有副作用，结果就会产生一个难以捉摸的错误。

5. 神秘的数
   神秘的数包括各种常数，数组的大小，字符位置，变换因子以及程序中出现的其他以文字形式写出的数值。
   给神秘的数起个名字

6. 注释
   注释是帮助程序读者的一种手段。但是，如果在注释中只说明代码本身已经讲明的事情，或者与代码矛盾，或是以精心编排的形式干扰读者，那么它们就是帮了倒忙。
   最好的注释是简洁地点明程序的突出特征，或是提供一种概观，帮助别人理解程序。

不要大谈明显的东西。
注释应该提供那些不能一下子从代码中看到的东西，或者把那些散布在许多代码里的信息收集到一起。当某些难以捉摸的事情出现时，注释可以帮助澄清情况。如果操作本身非常明了，重复谈论它们就是画蛇添足了。

给函数和全局数据加注释

放在每个函数前面的注释可以成为帮人读懂程序的台阶。
如果函数代码不太长，在这里写一行注释就足够了。
有些代码原本非常复杂，可能是因为算法本身很复杂，或者是因为数据结构非常复杂。在这些情况下，用一段注释指明有关文献对读者也很有帮助。此外，说明做出某种决定的理由也很有价值。

不要注释差的代码，重写它。应该注释所有不寻常的或者可能迷惑人的内容。但是如果注释的长度超过了代码本身，可能就说明这个代码应该修改了。

不要与代码矛盾。

注释不仅需要与代码保持一致，更应该能够支持它。

如果真的需要用许多话来解释出了什么事，这可能就说明了有关代码应该重写。

注释是一种工具，它的作用就是帮助读者理解程序中的某些部分，而这些部分的意义不容易通过代码本身直接看到。我们应该尽可能地把代码写得容易理解。在这方面你做得越好，需要写的注释就越少。好的代码需要的注释远远少于差的代码。

7. 为何如此费心

程序设计的风格：具有说明性的名字，清晰地表达式，直截了当的控制流，可读的代码和注释，以及在追求这些内容时一致地使用某些规则和惯用法的重要性。
书写良好的代码更容易阅读和理解，几乎可以保证其中的错误更少。进一步说，它们通常比那些马马虎虎的堆起来的，没有仔细推敲过得代码更短小。在这个拼命要把代码送出门，去赶上最后期限的时代，人们很容易把风格丢在一旁，让将来去管它们吧。但是，这很可能是一个代价非常昂贵的决定。

这里最关键的结论是：好风格应该成为一种习惯。如果你在开始写代码时就关心风格问题，如果你花时间去审视和改进它，你将会逐渐养成一种好的编程习惯。一旦这种习惯变成自动地东西，你的潜意识就会帮你照料许多细节问题，甚至你在工作压力下写出的代码也会更好。
