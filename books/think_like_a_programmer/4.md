# 用指针和动态内存解决问题

为了能够真正像程序员一样思考，必须学会自己的方式思考指针和基于指针的问题。

指针不仅允许我们进行静态的内存分配，还为我们提供了高效率地使用内存的新机会。
使用指针的 3 个主要优点是：

- 运行时确定长度的数据结构；
- 可改变长度的数据结构；
- 内存共享；

和数组一样，指针也存在一些潜在的缺陷，只能在适当的时候使用。也就是，只有当自己需要利用指针的一个或多个优点的时候才应该使用它。

例如，程序需要一个保存聚合数据的解构，但在程序实际运行之前无法准确地估计数据的数量时就可以使用指针。或者，当程序中需要传递大型对象或者其他数据块时，也可以使用指针来节省空间。但是，如果不是上述这几种情况，在使用指针和动态内存分配时就应该非常谨慎。

内存细节

堆栈和堆

程序的运行时堆栈。每当一个函数被调用时（包括 main 函数），都会在运行时堆栈的顶部为它分配一块内存，这块内存称为活动记录。活动记录就是变量的存储空间。所有的局部变量，包括函数的参数，都是在活动记录中分配的。

内存的大小
第一个与内存相关的实际问题是如何限制它的使用，以确保只在必要时才分配内存。

在多任务操作系统中，每个程序所浪费的每个直接的内存累加起来会导致当前所运行的程序没有足够的内存来运行。此时，操作系统就会把一个程序的内存块与其他程序的内存块进行交换，在短时间内会导致系统的性能大幅下降，这种情况称为系统颠簸(thrashing).

除了需要尽可能细地注意程序的总体内存使用情况之外，还要注意堆栈和堆都具有空间上限。

生命期
变量的生命期是指从它的分配直到销毁之间的时期。
对于在堆栈上所分配的变量（即局部变量或形式参数），对生命期的处理是隐式进行的。变量是在函数被调用时分配的，并在函数结束时被销毁。对于在堆上分配的变量（即用 new 动态分配的变量），它的生命期是由我们自己掌握的。管理动态分配变量的生命期是每个 C++程序员的基本素养。最明显的问题是内存泄露，即在堆上分配了内存但没有被销毁并且没有被任何指针所引用。
